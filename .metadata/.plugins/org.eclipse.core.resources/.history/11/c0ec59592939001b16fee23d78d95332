<%@page import="board.model.QnA"%>
<%@page import="java.util.List"%>
<%@page import="board.model.QnADAO"%>
<%@ page contentType="text/html;charset=utf-8"%>
<%
	//DB연동
	QnADAO dao = new QnADAO();
	List<QnA> list = dao.selectAll();

	int totalRecord = list.size(); //총 레코드 수
	int pageSize = 10;	//한 페이지 당 레코드 수
	int totalPage = (int) Math.ceil(((double) totalRecord / pageSize));
	int blockSize = 10;	//페이지 블록 단위
	int currentPage = 1;
	currentPage = Integer.parseInt(request.getParameter("currentPage"));
	int firstPage = currentPage%blockSize==0?currentPage-blockSize+1:currentPage/blockSize*blockSize+1;
	int lastPage = firstPage+blockSize-1;
	int num = totalRecord-((currentPage-1)*pageSize);
	int curPos = (currentPage-1)*pageSize;
	
%>
<%="총 레코드 수는 " + totalRecord + "<br>"%>
<%="총 페이지 수는 " + totalPage + "<br>"%>
<%="현재 페이지는 " + currentPage + "<br>"%>
<%="firstPage : " + firstPage + "\tlastPage : " + lastPage %>
<!DOCTYPE html>
<html>
<head>
<style>
table {
	border-collapse: collapse;
	border-spacing: 0;
	width: 100%;
	border: 1px solid #ddd;
}

th, td {
	text-align: left;
	padding: 16px;
}

tr:nth-child(even) {
	background-color: #f2f2f2;
}

a {
	text-decoration: none;
}

.pageNum {
	font-size: 20pt;
	color: red;
	font-weight: bold;
}
</style>
<meta charset="utf-8">
<title>Insert title here</title>
<script>
	
</script>
</head>
<body>
	<table>
		<tr>
			<th>No</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록일</th>
			<th>조회수</th>
		</tr>
		<%
			for (int i=1 i<=pageSize; i++) {
		%>
		<%if(num<1) break;%>
		<%QnA qna = list.get(curPos++);%>
		
		<tr>
			<td><%=num--%></td>
			<td>
    	<%if(qna.getRank() > 0) { // 답변이면 이미지 부여 %>
    	<img src="/images/reply.png" style="margin-left:<%=10*qna.getDepth()%>px" width="20px" height="20px">
    	<%} %>
		<a href="detail.jsp?qna_id=<%=qna.getQna_id()%>"><%=qna.getTitle()%></a>
			</td>
    		<td><%= qna.getWriter()%></td>
			<td><%=qna.getRegdate().substring(0,10)%></td>
			<td><%=qna.getHit()%></td>
  		</tr>
		<%}%>
		<tr>
			<td colspan="5" style="text-align: center">
			<%if(firstPage-1 !=0) { %>
			<a href="list2.jsp?currentPage=<%=firstPage-1%>">◀ </a>
			<%} %>
			<%for (int i = firstPage; i <= lastPage; i++) {%>
				<%if(totalPage < i)break; %>
				<% if (i == currentPage) { %> 
					<a href="list2.jsp?currentPage=<%=i%>" class="pageNum">[<%=i%>]</a> 
				<%} else {%> 
					<a href="list2.jsp?currentPage=<%=i%>">[<%=i%>]</a> 
						<%}%> 
					<%}%>
					<%if(lastPage+1 < totalPage) { %>
					<a href="list2.jsp?currentPage=<%=lastPage+1%>">▶</a>
					<%} %>
			</td>
		</tr>
		<tr>
			<td colspan="5"><button>글등록</button></td>
		</tr>
		<tr>
			<td colspan="5" style="text-align: center"><%@ include
					file="/inc/footer.jsp"%></td>
		</tr>

	</table>

</body>
</html>