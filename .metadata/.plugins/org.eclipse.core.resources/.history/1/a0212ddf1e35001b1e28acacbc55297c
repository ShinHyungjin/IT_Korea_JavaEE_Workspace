package board.gui;

import java.awt.Dimension;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import javax.swing.JButton;
import javax.swing.JOptionPane;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;

public class BoardWrite extends Page{
	JTextField t_title,t_author;
	JTextArea area;
	JScrollPane scroll;
	JButton bt;
	
	public BoardWrite(BoardMain boardMain) {
		super(boardMain);
		
		t_author = new JTextField();
		t_title = new JTextField();
		area = new JTextArea();
		scroll = new JScrollPane(area);
		bt = new JButton("글등록");
		
		t_author.setPreferredSize(new Dimension((int)this.getPreferredSize().getWidth()-10,25));
		t_title.setPreferredSize(new Dimension((int)this.getPreferredSize().getWidth()-10,25));
		scroll.setPreferredSize(new Dimension((int)this.getPreferredSize().getWidth()-10,500));
		
		add(t_author);
		add(t_title);
		add(scroll);
		add(bt);
		
		bt.addActionListener((e) -> {
			regist();
		});
	}
	public void regist() {
		Connection con = null;
		PreparedStatement pstmt =  null;
		String sql = "insert into notice(author, title, content) values(?,?,?)";
		
		con = boardMain.dbManager.getConnection();
		try {
			pstmt = con.prepareStatement(sql);
			pstmt.setString(1,t_author.getText());
			pstmt.setString(2,t_title.getText());
			pstmt.setString(3,area.getText());
			
			int result = pstmt.executeUpdate();
			
			if(result == 0) {
				JOptionPane.showMessageDialog(this, "등록 실패!");
			}else {
				JOptionPane.showMessageDialog(this, "등록 성공!");
			}
		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			boardMain.dbManager.release(con, pstmt);
		}
		
	}
}
